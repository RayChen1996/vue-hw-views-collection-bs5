<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>景點收藏</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css" />
    <link rel="stylesheet" href="./assets/style/all.css">
  </head>

  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">LOGO</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="Views.html">景點首頁</a>
              
            </li>
          
            <li class="nav-item">
               <a class="bookmark nav-link active" aria-current="page" href="ViewsCollection.html">景點收藏</a>
            </li>
          </ul>
          <form class="d-flex">
            <!-- <span>Hello <div id="User"></div> ！</span> -->
            <!-- <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search"> -->
            <!-- <button class="btn btn-outline-success" type="submit">Search</button> -->
            <button class="btn btn-success" id="login" type="button">登入</button>
            <button class="btn btn-outline-success" id="logout" type="button">登出</button>
          </form>
        </div>
      </div>
    </nav>

    
<h2>景點收藏</h2>
<div class="container text-center ViewCollection">
    <div class="row">

    </div>
</div>
<script src="./assets/js/all.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
function cancelViewId(ViewId){
    removeBookmark() 
    
}


function removeBookmark() {
let UserId = localStorage.getItem("userId");
  axios
    .get(`${BaseUrl}/user/${UserId}/bookmarks`)
    .then((res) => {
      console.log(res.data);
      const { data } = res;
      let thisId = 0;
      data.forEach((item) => {
        if (item.viewId === viewId) {
          thisId = item.id;
        }
      });

      return axios.delete(`${BaseUrl}/bookmarks/${thisId}`);
    })
    .then((res) => {
      console.log(res.data);
    })
    .catch((error) => {
      console.log(error);
    });
}


document.addEventListener("DOMContentLoaded", function(){
    
    


    axios.get(`${BaseUrl}/bookmarks`, { 
          
        })
        .then((res) => { 
   
            let CollectList =  res.data
            let StrHTML = ""
 
            const viewsElem = document.querySelector(".ViewCollection .row")
            let collectIdxs = []
  
            let Views = JSON.parse(localStorage.getItem("Views")) ;
            let userId = localStorage.getItem("userId") ;
            console.log(CollectList)
            let filter = CollectList.filter((item)=>{
                return item.userId == userId
            })

            const result = filter.filter((thing, index, self) =>
                index === self.findIndex((t) => (
                    t.viewId === thing.viewId && t.userId === thing.userId
                ))
            )
            

            result.forEach((item)=>{
                collectIdxs.push(item.viewId)
            })
            console.log(collectIdxs)
            console.log(Views)
            var tmp = []
            let RenderList = Views.filter((item)=>{
                
                for(var i in collectIdxs){
                    if(item.id==collectIdxs[i]){
                        tmp.push(item)
                    }
                    console.log(item.id)
                    console.log(collectIdxs[i])
                //     return collectIdxs[i] == item.id
                }                
            })

            console.log(tmp)
 
            console.log(RenderList)
            tmp.forEach((item,idx)=>{
              // <div class="col-sm-4 mt-3">
                    //     <div class="card" style="width: 20rem;">
                    //     <img class="card-img-top" src='${item.imgUrl}'>
                    //     <div class="card-block">
                    //         <h4 class="card-title">${item.title}</h4>
                    //         <p class="card-text">
                    //         <Button     onclick='cancelViewId(${item.id})' link-success card-link stretched-link mt-auto ms-auto" data-viewid=${item.id}>取消收藏</Button>
                    //         </p>
                    //     </div>
                    //     </div>
                    // </div>
                StrHTML += `
                    <div class="col">
                        <div class="card" style="width: 18rem;">
                            <img class="card-img-top" src='${item.imgUrl}' alt="Card image cap">
                            <div class="card-body">
                                <h5 class="card-title">${item.title}</h5>
                                <p class="card-text"></p>
                                <a href="#"  onclick='cancelViewId(${item.id})' data-viewid=${item.id} class="btn btn-danger">取消收藏</a>
                            </div>
                        </div>
                    </div>
                `            
            })
  
  
            viewsElem.innerHTML = StrHTML
        })
        .catch((error) => { 
            console.error(error) 
        })
        .finally(() => { 
          
        })


})
</script>

    <footer class="footer">
      
    </footer>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- <script src="https://unpkg.com/axios/dist/axios.min.js"></script> -->
    <script src="./assets/js/vendors.js"></script>
    <script src="./assets/js/all.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.2.1/axios.min.js" integrity="sha512-zJYu9ICC+mWF3+dJ4QC34N9RA0OVS1XtPbnf6oXlvGrLGNB8egsEzu/5wgG90I61hOOKvcywoLzwNmPqGAdATA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  </body>

</html>


<script>
  $(function(){
    const token = localStorage.getItem("token");
    const userId = localStorage.getItem("userId");
    const role = localStorage.getItem("role");

    if (token) {
      $("#login").hide()
      if(role=="admin"){
        $(".bookmark ").hide()
      }else{
        //user
      }


    }else{
      $(".bookmark ").hide()
      $("#logout").hide()
      //
    }

   

    $("#login").on("click",function(){
      window.location.href = "./login.html"
    })
    $("#logout").on("click",function(e) {
  
      e.preventDefault();

      localStorage.clear();

      Swal.fire({
        icon: "success",
        title: "已登出",
        showConfirmButton: false,
        timer: 1000,
      });

      setTimeout(() => {
        window.location.href = "./Views.html";
      }, 1500);



    })
  })

  // setTimeout(() => {
  //       window.location.href = "./Views.html";
  //   }, 1500);
</script>